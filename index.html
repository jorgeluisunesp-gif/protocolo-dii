<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocolo/Algoritmo - Paciente com DII</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Estilo para tabelas simuladas do PDF */
        .pdf-table th { @apply bg-gray-100 text-gray-700 font-semibold p-2 text-xs border border-gray-300; }
        .pdf-table td { @apply p-2 text-xs border border-gray-300; }
        .info-box { @apply bg-yellow-50 border border-yellow-200 rounded p-3 text-sm text-gray-700 mb-4; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

    <!-- Cabeçalho -->
    <header class="bg-blue-900 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold">Protocolo: Paciente com DII</h1>
                <p class="text-xs text-blue-200">Algoritmo de Manejo na Emergência</p>
            </div>
            <div class="text-right hidden md:block">
                <p class="text-xs opacity-75">Baseado em Protocolo Clínico</p>
            </div>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="flex-grow container mx-auto p-4 flex items-center justify-center">
        
        <div id="app-card" class="bg-white rounded-xl shadow-lg w-full max-w-3xl overflow-hidden border border-gray-200 fade-in">
            
            <!-- Barra de Status -->
            <div id="status-bar" class="bg-gray-100 p-3 border-b border-gray-200 flex justify-between items-center">
                <span class="text-xs font-semibold uppercase tracking-wider text-gray-500">Fluxo Atual</span>
                <span id="step-badge" class="px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-800 font-bold">Início</span>
            </div>

            <!-- Área de Conteúdo -->
            <div class="p-6 md:p-8">
                <div id="content-area">
                    <!-- Conteúdo injetado via JS -->
                </div>
            </div>

            <!-- Rodapé de Ações -->
            <div class="bg-gray-50 p-4 border-t border-gray-200 flex justify-between items-center">
                <button onclick="resetProtocol()" class="text-gray-500 hover:text-gray-700 text-sm font-medium flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Reiniciar
                </button>
                <button id="btn-back" onclick="goBack()" class="hidden text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Voltar
                </button>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-400 py-4 text-center text-xs">
        <p>Desenvolvido para fins de demonstração</p>
    </footer>

    <!-- Lógica (Máquina de Estados) -->
    <script>
        // Conteúdo Exato do PDF mapeado para estrutura JSON
        const protocolFlow = {
            start: {
                title: "Paciente com DII",
                type: "decision",
                status: "Triagem¹",
                // Tabela Triagem¹ do PDF recriada em HTML
                htmlContent: `
                    <div class="mb-4">
                        <p class="mb-2 text-sm text-gray-600">Avalie a hemodinâmica conforme <strong>Triagem¹</strong>:</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-center border-collapse pdf-table">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th class="bg-green-50 text-green-800">Leve</th>
                                        <th class="bg-yellow-50 text-yellow-800">Moderada</th>
                                        <th class="bg-red-50 text-red-800">Grave</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="font-bold text-left">FC</td>
                                        <td>< 90 bpm</td>
                                        <td>90-120 bpm</td>
                                        <td>> 120 bpm</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold text-left">PA</td>
                                        <td>Estável</td>
                                        <td>Estável</td>
                                        <td>Instável?</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold text-left">Tax</td>
                                        <td>Afebril</td>
                                        <td>Febril</td>
                                        <td>Febril</td>
                                    </tr>
                                    <tr>
                                        <td class="font-bold text-left">Sinais</td>
                                        <td>-</td>
                                        <td>Dor moderada</td>
                                        <td>Toxemia, Confusão</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `,
                options: [
                    { label: "Instável Hemodinamicamente", next: "instavel", style: "danger" },
                    { label: "Estável Hemodinamicamente", next: "estavel", style: "success" }
                ]
            },
            
            // --- RAMO INSTÁVEL ---
            instavel: {
                title: "Instável Hemodinamicamente",
                type: "critical",
                status: "Emergência",
                htmlContent: `
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
                        <h3 class="font-bold text-red-800">Medidas de estabilização</h3>
                        <ul class="list-disc ml-5 text-red-700 text-sm mt-1">
                            <li>Solicitar leito de UTI</li>
                        </ul>
                    </div>
                    <p class="font-bold text-gray-800">Estabilizou?</p>
                `,
                options: [
                    { label: "Não", next: "instavel", style: "danger" }, // Loop
                    { label: "Sim", next: "estavel_pos", style: "success" }
                ]
            },

            // --- RAMO ESTÁVEL ---
            estavel: {
                title: "Estável Hemodinamicamente",
                type: "step",
                status: "Triagem",
                htmlContent: `
                    <div class="text-center py-4">
                        <p class="text-lg text-gray-700 font-semibold">Prossiga</p>
                    </div>
                `,
                options: [
                    { label: "Continuar", next: "queixa", style: "primary" }
                ]
            },
            estavel_pos: { // Nó intermediário para quem veio do instável
                title: "Paciente Estabilizado",
                type: "step",
                status: "Estabilizado",
                htmlContent: `<p>Paciente agora estável hemodinamicamente. Prossiga para Anamnese.</p>`,
                options: [{ label: "Prossiga", next: "queixa", style: "primary" }]
            },

            queixa: {
                title: "Anamnese / Queixa Principal",
                type: "decision",
                status: "Anamnese",
                // Detalhes da Anamnese² do PDF
                htmlContent: `
                    <div class="info-box">
                        <h4 class="font-bold text-xs uppercase mb-1">Anamnese² - Verificar:</h4>
                        <ul class="list-disc ml-4 text-xs grid grid-cols-1 md:grid-cols-2 gap-x-4">
                            <li>Motivo do atendimento (dor intensa, sangramento, diarreia, febre)</li>
                            <li>Número e Padrão de evacuações</li>
                            <li>Histórico de febre / Dor localizada</li>
                            <li>Internações e cirurgias prévias</li>
                            <li>Presença de ostomia / Tratamento vigente</li>
                        </ul>
                    </div>
                    <p class="font-bold mb-2">Qual a Queixa Principal?</p>
                `,
                options: [
                    { label: "Dor Abdominal / Diarreia / Febre", next: "ramo_dor", style: "primary" },
                    { label: "Sangramento", next: "ramo_sangramento", style: "warning" }
                ]
            },

            // --- FLUXO DOR ABDOMINAL ---
            ramo_dor: {
                title: "Dor Abdominal / Diarreia / Febre",
                type: "action",
                status: "Investigação",
                htmlContent: `
                    <div class="space-y-3">
                        <div class="p-3 bg-blue-50 rounded border border-blue-100">
                            <strong>Conduta Imediata:</strong><br>
                            • Sintomáticos e Jejum
                        </div>
                        
                        <div class="p-3 bg-gray-50 rounded border border-gray-200 text-sm">
                            <strong>Solicitar Labs³:</strong>
                            <ul class="list-disc ml-4 text-xs text-gray-600 mt-1 columns-2">
                                <li>Hemograma c/ plaquetas</li>
                                <li>PCR e VHS</li>
                                <li>Albumina</li>
                                <li>Eletrólitos (Na, K, Mg)</li>
                                <li>Ureia e Creatinina</li>
                                <li>Transaminases (TGO, TGP)</li>
                                <li>TP e TTP</li>
                                <li>Beta-hCG (mulheres idade fértil)</li>
                                <li>Clostridium difficile / Coprocultura</li>
                            </ul>
                        </div>

                        <div class="p-3 bg-indigo-50 rounded border border-indigo-100">
                            <strong>Imagem:</strong><br>
                            TC de Abdome total c/ Contraste*<br>
                            <span class="text-xs italic">(Gestantes: Ecografia)</span>
                        </div>
                    </div>
                `,
                options: [
                    { label: "Verificar Resultados", next: "complicacoes_dor", style: "primary" }
                ]
            },

            complicacoes_dor: {
                title: "Avaliação dos Resultados",
                type: "decision",
                status: "Diagnóstico",
                htmlContent: `
                    <p class="mb-4">O exame de imagem evidencia alguma das condições abaixo?</p>
                    <ul class="list-none space-y-2 font-semibold text-red-700 bg-red-50 p-4 rounded border border-red-100">
                        <li>• Obstrução / Estenose</li>
                        <li>• Abscesso / Fístula</li>
                        <li>• Perfuração</li>
                    </ul>
                `,
                options: [
                    { label: "Sim", next: "avaliacao_cirurgica", style: "danger" },
                    { label: "Não", next: "tratamento_clinico", style: "success" }
                ]
            },

            tratamento_clinico: {
                title: "Sem Complicações Cirúrgicas",
                type: "final",
                status: "Tratamento",
                htmlContent: `
                    <div class="mb-4">
                        <h3 class="font-bold text-green-800 text-lg mb-2">Conduta:</h3>
                        <ul class="list-disc ml-5 space-y-1 text-gray-800">
                            <li><strong>Tromboprofilaxia</strong></li>
                            <li><strong>Iniciar ATB ou corticoide</strong></li>
                        </ul>
                    </div>

                    <div class="info-box border-l-4 border-l-blue-500">
                        <p class="font-bold text-xs text-blue-800 mb-1">Antibióticos e Corticoides (Para moderada ou grave):</p>
                        <ul class="list-disc ml-4 text-xs">
                            <li>Hidrocortisona 100mg IV 6/6h</li>
                            <li>Ampicilina/Sulbactam</li>
                            <li>Piperacilina/Tazobactam</li>
                            <li>Meropenem</li>
                        </ul>
                    </div>

                    <div class="bg-blue-100 p-4 rounded text-center">
                        <strong>Solicitar Avaliação Gastro</strong>
                        <p class="text-xs mt-1 text-blue-800">
                            Leves e Moderados: Até 4h (dia útil)<br>
                            Graves: Contato imediato
                        </p>
                    </div>
                `,
                options: [] // Fim
            },

            // --- FLUXO SANGRAMENTO ---
            ramo_sangramento: {
                title: "Sangramento",
                type: "action",
                status: "Investigação",
                htmlContent: `
                    <div class="space-y-3">
                        <div class="p-3 bg-orange-50 rounded border border-orange-100">
                            <strong>Conduta Imediata:</strong><br>
                            • Sintomáticos e Jejum<br>
                            • Hemotransfusão SN (Se Necessário)
                        </div>
                        
                        <div class="p-3 bg-gray-50 rounded border border-gray-200 text-sm">
                            <strong>Solicitar Labs³</strong> (ver lista padrão)
                        </div>

                        <div class="p-3 bg-indigo-50 rounded border border-indigo-100">
                            <strong>Imagem:</strong><br>
                            Angio-TC de Abdome
                        </div>
                    </div>
                `,
                options: [
                    { label: "Encaminhar para Avaliação", next: "avaliacao_cirurgica_sangue", style: "primary" }
                ]
            },

            avaliacao_cirurgica_sangue: {
                title: "Avaliação Cirúrgica",
                type: "decision",
                status: "Decisão",
                htmlContent: `
                    <div class="bg-red-50 p-4 rounded mb-4 border border-red-200">
                        <p class="font-bold text-red-800">Avaliação cirúrgica Obrigatória</p>
                        <p class="text-xs text-red-600">Meta: Em até 2 horas</p>
                    </div>
                    <p class="font-bold">Existe Indicação cirúrgica?</p>
                `,
                options: [
                    { label: "Sim", next: "cirurgia", style: "danger" },
                    { label: "Não", next: "avaliacao_gastro_sangue", style: "success" }
                ]
            },

            // --- FINAIS COMUNS ---
            avaliacao_cirurgica: {
                title: "Avaliação Cirúrgica",
                type: "final",
                status: "Interconsulta",
                htmlContent: `
                    <div class="text-center p-6 bg-red-50 border border-red-200 rounded">
                        <h3 class="text-xl font-bold text-red-700 mb-2">Avaliação Cirúrgica</h3>
                        <p class="text-sm text-red-600">Meta de atendimento: <strong>Em até 2 horas</strong></p>
                    </div>
                `,
                options: []
            },
            cirurgia: {
                title: "Cirurgia",
                type: "final",
                status: "Centro Cirúrgico",
                htmlContent: `
                    <div class="text-center p-6 bg-red-100 border border-red-300 rounded">
                        <h3 class="text-2xl font-bold text-red-800">Proceder à Cirurgia</h3>
                        <p class="mt-2">Indicação confirmada.</p>
                    </div>
                `,
                options: []
            },
            avaliacao_gastro_sangue: {
                title: "Avaliação Gastro",
                type: "final",
                status: "Especialidade",
                htmlContent: `
                    <div class="text-center p-6 bg-blue-50 border border-blue-200 rounded">
                        <h3 class="text-xl font-bold text-blue-700">Avaliação Gastro</h3>
                        <div class="text-left text-xs mt-4 space-y-2 text-blue-900 bg-white p-3 rounded shadow-sm">
                            <p><strong>LEVES e MODERADOS:</strong> Em até 4 horas (08-17h dias úteis). Noite/FDS: próximo dia útil.</p>
                            <p><strong>GRAVES:</strong> Contato telefônico imediato com residente.</p>
                        </div>
                    </div>
                `,
                options: []
            }
        };

        // --- Engine da Aplicação ---
        let historyStack = [];
        let currentKey = 'start';

        document.addEventListener('DOMContentLoaded', () => {
            renderStep('start');
        });

        function renderStep(key) {
            const step = protocolFlow[key];
            const contentDiv = document.getElementById('content-area');
            const badge = document.getElementById('step-badge');
            
            // Atualiza Badge
            badge.innerText = step.status;
            badge.className = `px-3 py-1 text-xs rounded-full font-bold uppercase tracking-wide ${getStatusColor(step.type)}`;

            // Animação
            contentDiv.classList.remove('fade-in');
            void contentDiv.offsetWidth; 
            contentDiv.classList.add('fade-in');

            // Renderiza HTML
            let html = `
                <h2 class="text-2xl font-bold text-gray-800 mb-4">${step.title}</h2>
                <div class="text-base text-gray-700 mb-6">
                    ${step.htmlContent}
                </div>
            `;

            // Renderiza Botões
            if (step.options && step.options.length > 0) {
                html += `<div class="grid grid-cols-1 md:grid-cols-${step.options.length > 1 ? '2' : '1'} gap-3 mt-4">`;
                step.options.forEach(opt => {
                    html += `
                        <button onclick="nextStep('${opt.next}')" 
                            class="w-full py-4 px-6 rounded-lg shadow-sm font-bold text-white transition transform hover:-translate-y-1 hover:shadow-md focus:outline-none ${getBtnColor(opt.style)}">
                            ${opt.label}
                        </button>
                    `;
                });
                html += `</div>`;
            }

            contentDiv.innerHTML = html;
            currentKey = key;
            updateNavButtons();
        }

        function nextStep(key) {
            historyStack.push(currentKey);
            renderStep(key);
        }

        function goBack() {
            if(historyStack.length > 0) {
                const prev = historyStack.pop();
                renderStep(prev);
                // Ajuste para não duplicar o histórico ao renderizar o anterior
                // Na prática, renderStep define currentKey, que é o que precisamos
            }
        }

        function resetProtocol() {
            historyStack = [];
            renderStep('start');
        }

        function updateNavButtons() {
            const btnBack = document.getElementById('btn-back');
            if(historyStack.length > 0) {
                btnBack.classList.remove('hidden');
            } else {
                btnBack.classList.add('hidden');
            }
        }

        function getStatusColor(type) {
            switch(type) {
                case 'critical': return 'bg-red-100 text-red-800';
                case 'success': return 'bg-green-100 text-green-800';
                case 'decision': return 'bg-blue-100 text-blue-800';
                case 'final': return 'bg-gray-100 text-gray-800';
                default: return 'bg-blue-50 text-blue-600';
            }
        }

        function getBtnColor(style) {
            switch(style) {
                case 'danger': return 'bg-red-600 hover:bg-red-700';
                case 'success': return 'bg-green-600 hover:bg-green-700';
                case 'warning': return 'bg-orange-500 hover:bg-orange-600';
                default: return 'bg-blue-600 hover:bg-blue-700';
            }
        }
    </script>
</body>
</html>
